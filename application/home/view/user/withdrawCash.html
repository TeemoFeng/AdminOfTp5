{include file="common/header"/}
    <style>
        .layui-form input {
            background: #1c1e2d;
            border: 1px solid #3a3b54;
            height: 50px;
        }

        .layui-form input:hover {
            border: 1px solid #92a5eb;
        }

        .layui-form-select dl {
            background: #1c1e2d;
        }
    </style>

<div style="width: 100%; margin: 0px auto; min-height: 500px;">
    <div data-v-22eb5e9c="" class="global-width">
        <div data-v-22eb5e9c="" class="hc-breadcrumb hc-bgColor1"><span data-v-22eb5e9c=""
                                                                        class="hc-cursor">交易账户提现</span></div>
        <div data-v-22eb5e9c="" class="chargeMoney-top hc-bgColor3">
            <div data-v-22eb5e9c="" class="chargeMoney-left">
                <span data-v-22eb5e9c="" class="hc-color1-1">
                    <img data-v-22eb5e9c=""src="/static/home/images/tb.png" style="vertical-align: middle;">
                    <span data-v-22eb5e9c="" style="font-size: 16px;">提现【交易账户{$trade_account}】</span>
                </span>
            </div>
        </div>
        <div data-v-22eb5e9c="" class="chargeMoney-warp hc-bgColor1">
            <div data-v-22eb5e9c="" style="width: 730px; margin: 0px auto; padding: 45px 0px 20px;">
                <form action=""  class="layui-form" lay-filter="cash_sum">

                    <div data-v-22eb5e9c="" class="hc-color3 address-form-div1">
                        <span style="color: #FF5722;">提示：单笔最高可提100000,单笔给{$bonus_set['outer_disc_trans_to_waller']}%消费钱包，手续费{$bonus_set['outer_disc_trans_ratio']}%</span>
                    </div>
                    <div data-v-22eb5e9c="" class="address-form">
                        <div data-v-22eb5e9c="" class="address-form-div2">
                            <div data-v-22eb5e9c="" class="hc-color3 address-form-div1">金额</div>
                            <div data-v-22eb5e9c="" class="address-form-input1 el-input">
                                <input type="text" name="cash_sum"  autocomplete="off" class="el-input__inner" lay-verify="required" id="cash_sum">
                            </div>
                        </div>
                        <div data-v-22eb5e9c="" class="address-form-div2 address-form-div3">
                            <div data-v-22eb5e9c="" class="hc-color3 address-form-div1">
                                到账金额
                            </div>
                            <div data-v-22eb5e9c="" class="address-form-input1 el-input">
                                <input type="text" readonly="readonly" autocomplete="off"   name="real_sum" id="real_sum" class="el-input__inner">
                            </div>
                        </div>
                    </div>

                    <div data-v-22eb5e9c="" class="address-form">
                        <div data-v-22eb5e9c="" class="address-form-div1">
                            <div data-v-22eb5e9c="" class="hc-color3 address-form-div1">所属银行</div>
                            <select name="bank_id" lay-filter="aihao" data-v-b33ea7a8="" class="hc-form address-form-input1 hc-cursor" lay-verify="required">
                                <option value="">请选择</option>
                                {foreach $bank_list as $key => $val}
                                <option value="{$val['id']}" {if condition="$user_info['bank_id'] eq $val['id']"}selected{/if} >{$val['bank_name']}</option>
                                {/foreach}
                            </select>

                        </div>
                    </div>

                    <div data-v-22eb5e9c="" class="address-form">
                        <div data-v-22eb5e9c="" class="address-form-div1">
                            <div data-v-22eb5e9c="" class="hc-color3 address-form-div1">银行卡号</div>
                            <input type="text" name="bank_account"  autocomplete="off" class="el-input__inner" disabled value="{$user_info['bank_account']}" lay-verify="required">
                            <span style="color: #FF5722;">系统只接受您实名银行账户提现</span>
                        </div>
                    </div>
                    <div data-v-22eb5e9c="" class="address-form">
                        <div data-v-22eb5e9c="" class="address-form-div1">
                            <div data-v-22eb5e9c="" class="hc-color3 address-form-div1">开户姓名</div>
                            <input type="text" name="bank_user"  autocomplete="off" class="el-input__inner" disabled lay-verify="required" value="{$user_info['bank_user']}">

                        </div>
                    </div>

                    <div data-v-22eb5e9c="" class="address-form">
                        <div data-v-22eb5e9c="" class="address-form-div1">
                            <div data-v-22eb5e9c="" class="hc-color3 address-form-div1">开户行</div>
                            <input type="text" name="bank_desc"  autocomplete="off" class="el-input__inner" disabled value="{$user_info['bank_desc']}">

                        </div>
                    </div>

                    <div data-v-22eb5e9c="" class="address-form">
                        <div data-v-22eb5e9c="" class="address-form-div1">
                            <div data-v-22eb5e9c="" class="hc-color3 address-form-div1">支付宝</div>
                            <input type="text" name="alipay_account"  autocomplete="off" class="el-input__inner" disabled value="{$user_info['alipay_account']}">

                        </div>
                    </div>

                    <div data-v-22eb5e9c="" class="address-form">
                        <div data-v-22eb5e9c="" class="address-form-div1">
                            <div data-v-22eb5e9c="" class="hc-color3 address-form-div1">用户备注</div>
                            <input type="text" name="remark"  autocomplete="off" class="el-input__inner">

                        </div>
                    </div>
                    <div data-v-22eb5e9c="" class="address-form">
                        <div data-v-22eb5e9c="" class="address-form-div1">
                            <div data-v-22eb5e9c="" class="hc-color3 address-form-div1">手机号</div>
                            <input type="text" name="mobile" lay-verify="required" autocomplete="off" class="el-input__inner" disabled value="{$user_info['mobile']}">

                        </div>
                    </div>
                    <div data-v-22eb5e9c="" class="address-form">
                        <div data-v-22eb5e9c="" class="address-form-div1">
                            <div data-v-22eb5e9c="" class="hc-color3 address-form-div1">提现方式</div>
                            <select name="cash_method" lay-filter="cash_method" data-v-b33ea7a8="" class="hc-form address-form-input1 hc-cursor" lay-verify="required">
                                <option value="">请选择</option>
                                {foreach $cash_method as $key => $val}
                                <option value="{$key}">{$val}</option>
                                {/foreach}
                            </select>

                        </div>
                    </div>
                    <input type="hidden" id="poundage" name="poundage">
                    <input type="hidden" id="geiyouka" name="geiyouka">
                    <button data-v-22eb5e9c="" type="button" class="el-button address-form-btn el-button--danger" lay-submit="" lay-filter="submit">
                    <span>
                        <span data-v-22eb5e9c="">确认提现</span>
                    </span>
                    </button>
                </form>
            </div>
            <div data-v-22eb5e9c="" class="chargeMoney-line1"></div>
            <div data-v-22eb5e9c="" class="hc-color chargeMoney-p"  style="margin-left: 40px; margin-right: 40px; margin-top: 50px;">
                <div data-v-22eb5e9c="" style="margin-bottom: 5px;">
                    <i data-v-22eb5e9c="" class="fa fa-exclamation-circle hc-color4" style="font-size: 22px;"></i>
                    <span data-v-22eb5e9c="" style="font-size: 16px; margin-left: 10px;">温馨提示</span>
                </div>
                <p data-v-22eb5e9c="">1. 最小提现金额为：1。</p>
                <p data-v-22eb5e9c="">2. 为保障资金安全，当您账户安全策略变更、密码修改，我们会对提现进行人工审核，请耐心等待工作人员电话或邮件联系。</p>
                <p data-v-22eb5e9c="">3. 请务必确认电脑及浏览器安全，防止信息被篡改或泄露。</p>
            </div>
            <div data-v-22eb5e9c="" class="chargeMoney-line2"></div>
            <div data-v-22eb5e9c="" class="address-bot">
                <div data-v-22eb5e9c="" class="address-div1 hc-bgColor3">
                    <div data-v-22eb5e9c="" class="address-div2">最近10次提现记录</div>
                    <div data-v-22eb5e9c="" style="float: right; margin-right: 30px; font-size: 16px;"><span
                            data-v-22eb5e9c="" class="hc-color4 hc-cursor">查看更多</span></div>
                </div>
                <div data-v-22eb5e9c="" class="el-table el-table--fit el-table--enable-row-hover">
                    <div class="el-table__header-wrapper">
                        {if !empty($user_cash_list)}

                        <table cellspacing="0" cellpadding="0" border="0" class="el-table__header"
                               style="width: 1158px;">
                            <colgroup>
                                <col name="el-table_3_column_10" width="166">
                                <col name="el-table_3_column_11" width="164">
                                <col name="el-table_3_column_13" width="164">
                                <col name="el-table_3_column_14" width="164">
                                <col name="el-table_3_column_14" width="164">
                                <col name="el-table_3_column_14" width="164">
                            </colgroup>
                            <thead class="has-gutter">
                            <tr class="">
                                <th colspan="1" rowspan="1" class="el-table_3_column_10     is-leaf">
                                    <div class="cell">时间</div>
                                </th>
                                <th colspan="1" rowspan="1" class="el-table_3_column_11     is-leaf">
                                    <div class="cell">提现数量</div>
                                </th>
                                <th colspan="1" rowspan="1" class="el-table_3_column_13     is-leaf">
                                    <div class="cell">手续费</div>
                                </th>
                                <th colspan="1" rowspan="1" class="el-table_3_column_13     is-leaf">
                                    <div class="cell">实际到账</div>
                                </th>
                                <th colspan="1" rowspan="1" class="el-table_3_column_13     is-leaf">
                                    <div class="cell">提现方式</div>
                                </th>
                                <th colspan="1" rowspan="1" class="el-table_3_column_14     is-leaf">
                                    <div class="cell">状态</div>
                                </th>
                                <th class="gutter" style="width: 0px; display: none;"></th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                    <div class="el-table__body-wrapper is-scrolling-none">
                        <table cellspacing="0" cellpadding="0" border="0" class="el-table__body" style="width: 1158px;">
                            <colgroup>
                                <col name="el-table_3_column_10" width="166">
                                <col name="el-table_3_column_11" width="164">
                                <col name="el-table_3_column_13" width="164">
                                <col name="el-table_3_column_14" width="164">
                                <col name="el-table_3_column_14" width="164">
                                <col name="el-table_3_column_14" width="164">
                            </colgroup>
                            <tbody>
                            {foreach $user_cash_list as $k => $v}
                            <tr>
                            <td rowspan="1" colspan="1" class="el-table_3_column_10  ">
                                <div class="cell">
                                    {$v['create_time']}
                                </div>
                            </td>
                            <td rowspan="1" colspan="1" class="el-table_3_column_11  ">
                                <div class="cell">
                                    {$v['cash_sum']}
                                </div>
                            </td>
                            <td rowspan="1" colspan="1" class="el-table_3_column_12  ">
                                <div class="cell">
                                    {$v['poundage']}
                                </div>
                            </td>
                            <td rowspan="1" colspan="1" class="el-table_3_column_13  ">
                                <div class="cell">{$v['real_sum']}</div>
                            </td>
                            <td rowspan="1" colspan="1" class="el-table_3_column_14  ">
                                <div class="cell">{$cash_method[$v['cash_method']]}</div>
                            </td>
                                <td rowspan="1" colspan="1" class="el-table_3_column_14  ">
                                    <div class="cell">{$status[$v['status']]}</div>
                                </td>
                            </tr>
                            {/foreach}


                            </tbody>
                        </table>
                        {else /}
                        <div class="el-table__empty-block" style="width: 1158px;"><span class="el-table__empty-text">暂无数据</span>
                        </div>
                        {/if}
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
{include file="common/footer"/}
<script src="/static/home/layui/layui.js"></script>
<script>
    layui.use(['form', 'layedit', 'laydate'], function () {
        var form = layui.form
            , layer = layui.layer
            , $ = layui.jquery
            , layedit = layui.layedit
            , laydate = layui.laydate;

        var user_account = {$trade_account};
        var trans_to_waller_ratio = {$bonus_set['outer_disc_trans_to_waller']};
        var trans_ratio =  {$bonus_set['outer_disc_trans_ratio']};


        $("#cash_sum").bind('input propertychange',function(){
            var val = $(this).val();
            var regPos = /^\d+(\.\d+)?$/; //非负浮点数
            if(parseFloat(val)>parseFloat(user_account)){
                $(this).val('');
                layer.msg('提取金额大于余额，请重新选择', {time: 1800, icon: 2});
            }
            if(parseFloat(val) == 0){
                $(this).val('');
                layer.msg('提取金额要需大于0', {time: 1800, icon: 2});
            }
            if(parseFloat(val)>parseFloat(100000.00)){
                $(this).val('');
                layer.msg('提取金额不能大于100000', {time: 1800, icon: 2});
            }

            if(regPos.test(val)){
                //计算到账金额
                var ratio = FloatAdd(trans_to_waller_ratio,trans_ratio);
                var ratio2 = FloatDiv(ratio,100);
                var ratio3 = FloatSub(1, ratio2);
                var real_num = FloatMul(val,ratio3);
                real_num = parseFloat(real_num).toFixed(2); //到账金额
                var geiyouka_ratio = FloatDiv(trans_to_waller_ratio,100);
                var shouxu_ratio = FloatDiv(trans_ratio,100);
                var geiyouka = FloatMul(val,geiyouka_ratio); //给油卡费用
                var poundage = FloatMul(val,shouxu_ratio); //交易手续费

                $('#geiyouka').val(geiyouka);
                $('#poundage').val(poundage);
                $('#real_sum').val(real_num);

            }else{
                //如果输入的格式不对，清空
                $(this).val('');
                $('#geiyouka').val('');
                $('#poundage').val('');
            }
        });

        //除法
        function FloatDiv(arg1,arg2){
            var t1=0,t2=0,r1,r2;
            try{t1=arg1.toString().split(".")[1].length}catch(e){}
            try{t2=arg2.toString().split(".")[1].length}catch(e){}
            with(Math){
                r1=Number(arg1.toString().replace(".",""));
                r2=Number(arg2.toString().replace(".",""));
                return (r1/r2)*pow(10,t2-t1);
            }
        }

        //减法
        function FloatSub(arg1,arg2){
            var r1,r2,m,n;
            try{r1=arg1.toString().split(".")[1].length}catch(e){r1=0}
            try{r2=arg2.toString().split(".")[1].length}catch(e){r2=0}
            m=Math.pow(10,Math.max(r1,r2));
            //动态控制精度长度
            n=(r1=r2)?r1:r2;
            return ((arg1*m-arg2*m)/m).toFixed(n);
        }


        //浮点数加法运算
        function FloatAdd(arg1,arg2){
            var r1,r2,m;
            try{r1=arg1.toString().split(".")[1].length}catch(e){r1=0}
            try{r2=arg2.toString().split(".")[1].length}catch(e){r2=0}
            m=Math.pow(10,Math.max(r1,r2));
            return (arg1*m+arg2*m)/m;
        }


        //浮点数乘法运算
        function FloatMul(arg1,arg2) {
            var m = 0, s1 = arg1.toString(), s2 = arg2.toString();
            try {
                m += s1.split(".")[1].length
            } catch (e) {
            }
            try {
                m += s2.split(".")[1].length
            } catch (e) {
            }
            return Number(s1.replace(".", "")) * Number(s2.replace(".", "")) / Math.pow(10, m);

        }

        form.on('submit(submit)', function (data) {
        var loading = layer.load(2, {shade: [0.1,'#fff']});
        $.post("{:url('withdrawCash')}", data.field, function (res) {
            layer.close(loading);
            if (res.code > 0) {
                layer.msg(res.msg, {time: 1800, icon: 1}, function () {
                    location.reload();
                });
            } else {
                layer.msg(res.msg, {time: 1800, icon: 2});
            }
        });
        });


    });
</script>
